# APM 内存库日志格式和日志记录说明

## 目的和指导原则

日志条目对于项目跟踪、上下文保留以及代理或项目阶段之间的有效交接至关重要。它们必须**简洁而信息丰富**。目标是提供对所采取行动、做出的关键决策、生成的关键输出以及遇到的任何重大问题及其解决方案的清晰摘要。日志并非旨在成为所有活动的详尽记录，也不是所有生成的代码或数据的逐字副本。

## 1. 目的

本文档定义了在代理项目管理 (APM) 框架内对项目 `Memory_Bank.md` 文件进行的所有条目的标准格式。它还为任何负责记录其工作的代理提供直接指示。

**必须遵守此格式**，以确保一致性，方便经理代理和用户审查，实现有效的上下文交接，保持清晰的项目历史记录，并提供任务和结果之间的可追溯性。

## 2. 记录代理（实施、专业等）的说明

*   **何时记录：** 在完成任何分配的任务或子任务、达到重要里程碑（例如，完成一个主要功能、完成一个复杂模块的设置）、遇到障碍或生成与您的任务相关的显著结果/输出时，您必须立即在指定的 `Memory_Bank.md` 文件中添加一个条目。**至关重要的是，您需要将任务的状态告知用户，他将决定是否记录并向经理报告。**
*   **查阅您的提示：** 您的任务分配提示由经理代理通过用户提供，应明确指示您在完成后根据本指南记录您的工作。如果不确定任务范围，请回头查阅。
*   **找到内存库：** 经理代理或用户将指定正确 `Memory_Bank.md` 文件的路径（对于大型项目，可能有多个）。如果不确定，请请求澄清。日志条目通常应附加到文件末尾。
*   **使用定义的格式：** 根据下面第 3 节中概述的 Markdown 格式精确地构建您的日志条目。密切注意必填字段和格式。
*   **清晰简洁：** 提供足够的细节，以便经理代理了解您*做了什么*、*为什么*（链接到任务要求）、*结果是什么*以及遇到的任何问题。避免过多的冗长，但要确保所有关键信息都存在。
*   **使用确切的任务参考：** 将 `Implementation_Plan.md` 或您的分配提示中的*确切*任务标识符（例如，`阶段 1 / 任务 A / 项目 2`）复制到 `任务参考` 字段中。
*   **代码更改：** 在记录代码修改时，使用标准代码块（`` ` `` 和 ``` ```）。清楚地指出修改的文件。提供更改的片段通常比整个文件更有用。在代码块内使用类似 diff 的语法（`+` 表示添加，`-` 表示删除）*如果能增加清晰度*，但不要在代码块围栏中使用特定的 `diff` 语言说明符 (```diff)。
*   **错误和障碍：** 如果日志是关于错误或阻塞的，则清楚地说明遇到的任何错误或无法完成任务的原因。在 `输出/结果` 或 `问题/障碍` 部分提供相关的错误消息或堆栈跟踪。如果被阻止，请清楚地解释障碍，以便经理代理可以理解障碍。

## 3. 内存库条目格式 (Markdown)

每个日志条目必须使用 Markdown 水平规则 (`---`) 与前一个条目明确分开，并且必须遵循以下结构：

```markdown
---
**代理：** [您分配的代理 ID，例如，代理 B，调试器 1 - 使用经理代理分配的标识符]
**任务参考：** [来自 Implementation_Plan.md 的确切参考，例如，任务 B，子任务 2 或阶段 1 / 任务 C / 项目 3]

**摘要：**
[对所采取的行动或记录的结果的简短（1-2 句）高级摘要。要点是什么？]

**详细信息：**
[对所执行工作的更详细解释。包括：
    - 按逻辑顺序采取的步骤。
    - 在任务期间做出的重要决策的基本原理（特别是如果偏离或做出选择）。
    - 如果适用，将行动链接回任务描述中提到的特定要求。
    - 观察或主要发现。]

**输出/结果：**
[在此处包含相关输出。对代码片段、终端日志或命令输出使用 Markdown 代码块 (```)。指明创建/修改文件的文件路径。对于代码更改，显示相关片段。文本结果或摘要可以直接放置。如果输出很大，请考虑保存到单独的文件并在此处引用路径。]
```[代码片段、命令输出、文件路径参考或文本结果]```

**状态：** [选择一个：
    - **已完成：** 分配的任务/子任务已根据要求成功完成。
    - **部分完成：** 取得了重大进展，但任务尚未完全完成。在"详细信息"或"后续步骤"中解释剩余部分。
    - **已阻止：** 由于外部因素或未满足先决条件而无法继续。在"问题/障碍"中解释。
    - **错误：** 发生错误，导致无法成功完成。在"问题/障碍"中解释，并在"输出/结果"中提供错误详细信息。
    - **仅供参考：** 记录与直接任务完成无关的发现、决策或观察。]

**问题/障碍：**
[描述遇到的任何问题、发生的错误（如果未在"输出"中详细说明）或被阻止的原因。请具体说明，并尽可能提供可操作的信息。如果没有问题，请注明"无"。]

**后续步骤（可选）：**
[注意您或他人需要立即采取的任何后续行动，或者如果部分完成，则为下一个逻辑任务。用于指导经理代理。否则，请注明"无"或省略。]

```

## 4. 示例条目

```markdown
---
**代理：** 代理 A
**任务参考：** 阶段 1 / 任务 A / 项目 2 (实施注册端点)

**摘要：**
实施了用户注册的后端 API 端点 (`POST /api/users/register`)，包括输入验证和密码哈希。

**详细信息：**
- 按照指定在 `routes/user.js` 中创建了 API 路由 `POST /api/users/register`。
- 使用 `express-validator` 库添加了输入验证，以检查有效的电子邮件格式和最小密码长度（8 个字符），以符合要求。
- 根据安全最佳实践，集成了 `bcrypt` 库（成本因子 12）用于在存储前进行安全的密码哈希。
- 使用配置的 ORM (`User` 模型) 编写了将新用户记录存储在 PostgreSQL 数据库中的逻辑。
- 确保成功注册后仅返回非敏感用户数据（ID、电子邮件、姓名）以防止数据泄露。使用有效的和无效的示例数据在本地测试了端点。

**输出/结果：**
```
// routes/user.js 中显示验证和哈希逻辑的片段
router.post(
  '/register',
  [
    check('email', 'Please include a valid email').isEmail(),
    check('password','Please enter a password with 8 or more characters').isLength({ min: 8 })
  ],
  async (req, res) => {
    // ... 验证错误处理 ...
    const { name, email, password } = req.body;
    try {
      let user = await User.findOne({ email });
      if (user) {
        return res.status(400).json({ errors: [{ msg: 'User already exists' }] });
      }
      user = new User({ name, email, password });
      const salt = await bcrypt.genSalt(12);
      user.password = await bcrypt.hash(password, salt);
      await user.save();
      // 返回 JWT 或用户对象（省略密码）
      // ... 令牌生成逻辑 ...
      res.json({ token }); // 示例响应
    } catch (err) {
      console.error(err.message);
      res.status(500).send('Server error');
    }
  }
);
```

**状态：** 已完成

**问题/障碍：**
无

**后续步骤（可选）：**
准备继续执行任务 A / 项目 3 (实施登录端点)。
```

---

## 实现简洁和信息丰富

为确保日志有价值而又不会让人不知所措，请遵守以下原则：

*   **总结，不要转录：** 与其详细说明每个微小的步骤或内部思维过程，不如总结整个行动及其结果。
    *   *效果较差：* "我决定查看数据文件。我打开了 `train.csv` 文件。然后我运行了 `.head()` 命令来查看前几行。然后我运行了 `.info()` 来查看数据类型。然后我运行了 `.describe()`。"
    *   *效果更好：* "加载了 `train.csv`。使用 `.head()`、`.info()` 和 `.describe()` 进行初步检查，发现 [关键观察，例如，数据类型、是否存在空值、基本统计分布]。"

*   **关注关键信息：** 优先考虑对另一个代理或人类审查员理解至关重要的信息：
    *   此任务段的目标是什么？
    *   为实现它采取了哪些关键行动？
    *   重要的发现或输出是什么？
    *   做出了哪些决定，简要的理由是什么？
    *   是否有任何意外问题，以及如何解决？

*   **代码片段 - 谨慎使用：**
    *   *仅当*代码片段简短、对于理解特定、新颖或复杂的解决方案至关重要，或代表关键配置时，才包括代码片段。
    *   不要包括冗长的样板代码、可以轻松推断的常见库调用或大量的脚本输出。
    *   如果需要引用大量代码（例如，编写的实用程序函数），请说明已创建/修改并提交到相关脚本文件，然后引用该文件。

*   **避免冗余：** 如果信息已在另一个主要项目产物中清晰记录并可访问（例如，`Implementation_Plan.md` 概述了任务目标，提交的脚本包含完整代码），请简要引用该产物，而不是在日志中大量重复其内容。
    *   *示例：* "按照 `Implementation_Plan.md` 中任务 2.3 的定义实施了预处理步骤。核心函数 `preprocess_text()` 已添加到 `scripts/preprocessing_utils.py`。"

## 日志条目详细程度示例

考虑任务："加载并检查训练和验证数据集。"

**1. 好的简洁日志条目：**

```
### 日志条目

*   **状态：** 已完成
*   **摘要：** 加载了 `train_dataset.csv` (10000x3) 和 `val_dataset.csv` (2000x3)。初步检查显示"文本"和"情感"列。"情感"中没有缺失值。"文本"列在训练集（5）和验证集（2）中有一些空值，需要处理。情感分布在训练集中似乎是平衡的，在验证集中略微偏向积极。平均文本长度为 X 个字符。
*   **输出：** 记录了 train_df、val_df 的形状。记录了空值计数。
*   **决策：** 确认数据加载成功。为下一个预处理步骤记录了空值。
*   **问题：** 无。
```

**2. 过于冗长的日志条目（应避免）：**

```
### 日志条目

*   **状态：** 已完成
*   **摘要：** 我开始考虑加载数据。计划说要加载 `train_dataset.csv`。所以我写了 `train_df = pd.read_csv('data/train_dataset.csv')`。这个命令成功运行了。然后我想看看数据，所以我做了 `print(train_df.head())`。输出是 [输出头部]。然后我运行了 `print(train_df.info())`，它显示了 [输出信息]。我还用 `train_df.isnull().sum()` 检查了空值，它显示了 [输出空值]。我对 `val_dataset.csv` 也做了同样的操作。我写了 `val_df = pd.read_csv('data/val_dataset.csv')`。这也成功了。我也打印了它的头部和信息。看起来数据没问题。形状是 (10000,3) 和 (2000,3)。
*   **输出：** 打印了 train_df 的头部，train_df 的信息，train_df 的空值。打印了 val_df 的头部，val_df 的信息，val_df 的空值。
*   **决策：** 决定文件加载正确。
*   **问题：** 输入所有打印语句花了一段时间。
```