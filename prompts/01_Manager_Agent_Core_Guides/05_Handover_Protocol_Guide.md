# APM 交接协议指南

## 1. 目的和范围

本文档概述了 **代理项目管理 (APM) 交接协议**。其主要目的是在需要在 AI 代理实例之间进行上下文转移时，确保项目的无缝连续性。这最常在活动代理（通常是经理代理，但也可能是调试器或实施者等专业代理）接近其操作上下文窗口限制，威胁其维持对项目状态和历史的连贯理解的能力时触发。

该协议促进了将必要的项目知识从即将离任的（"现任"）代理转移到新的、即将上任的代理实例，最大限度地减少了中断并保持了项目工作流程的完整性。

本指南提供了执行成功交接的程序步骤和内容要求。它主要供监督交接过程的经理代理使用，但对用户的理解也至关重要。

## 2. 触发条件

在以下情况下应启动交接协议：

*   **上下文窗口限制：** 现任代理（经理或专业人员）表示，或用户观察到，其上下文窗口已接近容量，可能导致对早期指令、决策或项目细节的记忆丧失。
*   **战略性代理更换：** 用户出于战略原因决定用新的代理实例替换当前的代理实例（例如，升级到不同的模型，重新确定代理职责范围）。
*   **项目持续时间延长：** 对于预计运行时间明显长于单个代理上下文寿命的项目，可以主动安排计划的交接。

**启动：** 用户通常启动交接过程。然而，经理代理负责监控自己的上下文，并在由于上下文限制而有必要进行交接时向用户提出建议。

## 3. 交接组件

该协议包括由现任经理代理（或者如果专业化，则由启动交接的代理）生成的两个关键产物：

### 3.1. `Handover_File.md`（上下文转储）

*   **目的：** 作为即将离任的代理积累的所有相关项目上下文的全面、结构化的转储。该文件作为即将上任的代理的主要知识库。
*   **内容要求：** 文件必须概括当前的项目状态。虽然具体的格式细节在 `prompts/02_Utility_Prompts_And_Format_Definitions/Handover_Artifact_Formats.md` 中定义，但 `Handover_File.md` 通常必须包括：
    *   **项目摘要：** 高级目标、当前状态和目标。
    *   **实施计划状态：** 链接到或嵌入当前的 `Implementation_Plan.md`，突出显示已完成的任务、正在进行的任务和即将到来的任务。注意与原始计划的任何偏差或批准的更改。
    *   **关键决策和基本原理：** 做出的重要决策、理由和用户批准的日志。
    *   **代理名册和角色：** 活动的实施或专业代理列表、他们的任务以及当前状态（如果已知）。
    *   **最近的内存库条目：** `Memory_Bank.md` 中最新/最相关日志的摘要或逐字副本，为正在进行的工作提供即时上下文。
    *   **关键代码片段/输出：** 最近生成或经常引用的基本代码、配置或输出。
    *   **障碍和挑战：** 任何已知的障碍、风险或未解决的问题。
    *   **用户指令：** 来自用户的最近或未完成的指令记录。
    *   **文件清单（可选但推荐）：** 关键项目文件及其用途的列表。
*   **格式：** 必须遵守 `prompts/02_Utility_Prompts_And_Format_Definitions/Handover_Artifact_Formats.md` 中定义的结构，以确保即将上任的代理可以解析。

### 3.2. `Handover_Prompt.md`（新代理初始化）

*   **目的：** 初始化*新的*代理实例，为其提供标准的 APM 框架方向和无缝接管项目所需的特定上下文。
*   **内容要求：** 此提示至关重要，必须包含：
    *   **APM 框架介绍：** 包含来自标准 `prompts/00_Initial_Manager_Setup/01_Initiation_Prompt.md` 的基本部分。这包括 APM 工作流程概述、代理的核心职责（根据即将到来的角色进行调整，例如，"您正在接任经理代理......"）以及 APM 资产的重要性。
    *   **交接上下文介绍：** 明确说明这是一个交接情况。
    *   **`Handover_File.md` 摘要：** 提供随附的 `Handover_File.md` 的结构和关键内容的简明概述。
    *   **处理说明：** 指示新代理彻底阅读、解析和内化 `Handover_File.md` 内容的明确说明。
    *   **近期目标：** 根据交接上下文，明确说明新代理的近期后续步骤或优先事项（例如，"审查任务 X 状态"，"为代理 B 准备提示"，"解决用户关于 Y 的查询"）。
    *   **验证步骤：** 指示新代理通过向用户总结项目状态和近期目标来确认其对交接上下文的理解及其准备就绪情况。
*   **格式：** 应遵循 `prompts/02_Utility_Prompts_And_Format_Definitions/Handover_Artifact_Formats.md` 中为交接提示定义的结构和原则，确保清晰和可操作的说明。

## 4. 交接程序（经理代理重点）

现任经理代理按如下方式执行交接（在用户监督下）：

1.  **确认：** 用户确认需要交接。
2.  **`Handover_File.md` 生成：**
    *   有关格式，请参阅 `Handover_File_Content.md` 指南。
    *   收集所有必要的上下文（如第 3.1 节所述）。
    *   将内容结构化并写入名为 `Handover_File.md`（或用户指定的名称）的新文件中。
    *   将生成的文件提交给用户进行审查和可选修改。
3.  **`Handover_Prompt.md` 生成：**
    *   起草提示内容（如第 3.2 节所述）。
    *   至关重要的是，整合来自 `01_Initiation_Prompt.md` 的核心部分。
    *   引用生成的 `Handover_File.md`。
    *   为即将上任的代理指定近期的后续步骤。
    *   将生成的提示提交给用户进行审查和批准。
4.  **执行：** 用户获取批准的 `Handover_Prompt.md` 和 `Handover_File.md`，并使用它们在新的会话中初始化新的经理代理实例。
5.  **验证：** 新的经理代理处理提示和文件，然后向用户确认其准备就绪和理解。

## 5. 专业代理的交接

虽然主要关注点是经理代理，但该协议可以适用于达到其上下文限制的专业代理（实施者、调试器等）。

*   **启动：** 通常由用户或经理代理观察到专业代理的上下文问题时触发。
*   **责任：** 经理代理通常监督此过程。
*   **`Handover_File.md`（简化版）：** 包含*仅*与专业代理当前任务或责任范围相关的上下文（例如，正在调试的特定功能、相关的代码文件、最近的错误消息、任务要求）。
*   **`Handover_Prompt.md`（简化版）：** 初始化新的专业代理实例，解释交接，指向简化的交接文件，并重申具体的任务目标。它通常*不*需要来自经理启动提示的完整 APM 介绍。

## 6. 最终考虑

*   **用户监督：** 用户在确认交接需求、审查生成的产物（`Handover_File.md`、`Handover_Prompt.md`）和启动新代理实例方面发挥着关键作用。
*   **清晰和准确：** 交接的成功完全取决于交接文件和提示中提供的信息的清晰度、准确性和完整性。即将离任的代理在生成时必须勤勉。
*   **迭代过程：** 用户可能会在最终确定之前要求对交接文件或提示进行修订。

该协议为在 APM 框架内保持项目势头和知识连续性提供了标准化的机制。

### 步骤 X：整合最近的对话上下文（即将离任的 MA）

**目标：** 确保交接不仅捕获正式记录的项目状态，还捕获最新、可能未记录的用户意图和指令。

**行动：**

1.  **审查最近的互动：** 在最终确定 `Handover_File.md` 和 `Handover_Prompt.md` 之前，即将离任的经理代理 (OMA) 必须明确审查与用户最近的 N 次（例如，5-10 次，或涵盖最新重要互动的合理范围）对话轮次的记录。

2.  **识别关键的未记录信息：** 从此审查中，识别：
    *   任何关键的用户指令或指示。
    *   项目优先级或重点的微妙变化。
    *   用户表达的新想法或要求。
    *   对正在进行或即将到来的任务有重大影响的上下文澄清。
    *   对于即将上任的经理代理 (IMA) 来说至关重要但可能尚未在内存库中正式记录或在 `Implementation_Plan.md` 中立即更新的任何信息。

3.  **总结发现：** 准备一份关于"用户意图的最新层次"的简洁、要点式摘要。重点关注可操作的信息或关键上下文。

4.  **更新交接产物：**
    *   此摘要必须包含在 `Handover_File.md` 的专用部分中（例如，"第 7 节：最近的对话上下文和关键用户指令"）。有关精确的结构，请参阅 `Handover_Artifact_Format.md`。
    *   此摘要的见解也应用于通知和完善 `Handover_Prompt.md`，确保 IMA 明确了解这些最近的细微差别。

**基本原理：** 此步骤对于弥合正式记录的项目状态与即时、演变的对话上下文之间的任何潜在差距至关重要。它为 IMA 提供了对用户期望和项目微观动态的最当前和最完整的理解，从而实现更平稳、更有效的过渡。